#!/usr/bin/env bash
#	-e TRANSFORMERS_OFFLINE=1 \

if [[ "$1" != "" ]]; then
  BASH_COMMAND="$@"
else # not [[ "$1" != "" ]]
  BASH_COMMAND="--norc"
fi   # else [[ "$1" != "" ]]

sudo docker run -it \
	--network=host \
	--group-add=video \
	--ipc=host \
	--cap-add=SYS_PTRACE \
	--security-opt seccomp=unconfined \
	--device /dev/kfd \
	--device /dev/dri \
	-v /etc/passwd:/etc/passwd:ro \
	-v /etc/group:/etc/group:ro \
	-e HSA_OVERRIDE_GFX_VERSION=11.0.0 \
	-e VLLM_USE_V1=1 \
	-e VLLM_USE_TRITON_FLASH_ATTN=1 \
	-e FLASH_ATTENTION_TRITON_AMD_ENABLE=TRUE \
	-e FLASH_ATTENTION_TRITON_AMD_AUTOTUNE=TRUE \
	-v $HOME:$HOME:rw \
	-u $(id -u):$(id -g) \
	$(id -G | perl -pe 's/(\d+)/--group-add \1/g') \
	ge-vllm-rocm \
	bash \
	$BASH_COMMAND
